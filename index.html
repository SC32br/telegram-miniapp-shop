<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Термобатя - Магазин</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --primary-blue: #3885da;
      --light-blue: #e0f3fd;
      --gradient-blue-start: #2193b0;
      --gradient-blue-end: #6dd5ed;
      --success-green: #28a745;
    }
    body {
      position: relative;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      background:
        linear-gradient(120deg, rgba(220,245,255,0.7), rgba(130,170,220,0.62)),
        url('https://web.tk646.ru/wp-content/uploads/2025/07/gftg0wdufx1r0_9xrxonq_d28ae17e662d4e358d5b34cfa7411caf.jpg') center/cover no-repeat;
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    /* === КНОПКА КОРЗИНЫ === */
    #cartButton {
      position: fixed; top: 24px; right: 24px; z-index: 1000;
      display:flex;align-items:center;justify-content:center;width:54px;height:54px;
      background:linear-gradient(135deg,#2b95ff 25%,#7bd4fa 100%);
      border:none; border-radius:50%; box-shadow:0 6px 16px #1d96e88f;
      cursor:pointer; padding:0; transition:box-shadow 0.16s,background 0.18s;
    }
    #cartButton:hover { box-shadow:0 8px 20px #1d96e8b3; }
    #cartButton svg { margin:0; width: 26px; height: 26px; }
    #cartCount {
      font-size:14px;min-width:22px;height:22px;line-height:22px;
      background:#fb3660;color:#fff; position:absolute;top:2px;right:2px;
      border-radius:50%;padding:0 3px; text-align:center;display:none;font-weight:bold;
      box-shadow:0 2px 6px #d20b2d42;
    }
    /* === КНОПКА НАЗАД === */
    #universalBackButton {
        position: fixed; top: 24px; left: 24px; z-index: 1000;
        display: none; align-items:center; justify-content:center; width:54px; height:54px;
        background: rgba(255,255,255,0.85);
        border: 1px solid #dbe9f7; border-radius: 50%;
        box-shadow: 0 4px 14px rgba(29, 112, 184, 0.18);
        cursor: pointer; padding: 0; transition: all 0.18s;
    }
    #universalBackButton:hover { transform: scale(1.05); box-shadow: 0 6px 18px rgba(29, 112, 184, 0.25); }
    #universalBackButton svg { width: 26px; height: 26px; }

    /* === МОДАЛЬНЫЕ ОКНА === */
    .modal-overlay {
      display:none;position:fixed;z-index:2000;left:0;top:0;width:100vw;height:100vh;
      background:rgba(33,40,60,0.25);backdrop-filter:blur(3px);
      align-items:center;justify-content:center;
    }
    .modal-overlay.active { display: flex; }
    .modal-content {
      background: #f9fcff; border-radius: 22px;
      max-width: 370px; width: 98%;
      padding: 36px 20px 23px 20px; box-shadow: 0 12px 46px #1681b366;
      position: relative; text-align: center; animation: modalAppear 0.18s;
    }
    @keyframes modalAppear { from{transform:translateY(-17px) scale(0.98)} to{transform:none;} }
    .modal-close-btn {
      position:absolute;top:7px;right:11px;background:none;border:none;
      font-size:30px;color:#d1607f;font-weight:800;cursor:pointer;z-index:2;transition:color 0.17s;
    }
    .modal-close-btn:hover { color: #ff2f57;}
    /* === КОРЗИНА === */
    .cart-items-list {list-style:none;padding:0;margin:0 0 18px 0;text-align:left;max-height:190px;overflow-y:auto;}
    .cart-item {display:flex;align-items:center;justify-content:space-between;font-size:16px;padding:5px 0 8px 0;border-bottom:1px solid #e6f2fa;}
    .cart-item:last-child { border-bottom: none;}
    .cart-actions {margin:26px -8px 0 -8px;display:flex;flex-direction:row;gap:9px;justify-content:space-between;}
    .cart-actions .cartBtn {flex:1;display:flex;align-items:center;justify-content:center;gap:7px;font-size:1em;padding:12px 0;border-radius:17px;border:2px solid transparent;font-weight:800;cursor:pointer;box-shadow:0 2px 8px #1e92e933;transition:all 0.15s;background:#f2faff;color:#269be2;}
    #cartContinueBtn {border-color: #50bafc; background: #f2faff; color: #269be2;}
    #cartContinueBtn:hover {background:#e7f5fc;color:#0077b6;border-color:#31a8dd;}
    #cartContinueBtn svg { margin-right:4px;}
    #cartOrderBtn {background:linear-gradient(90deg,#219b37 0%,#26e29a 100%);color:#fff;border:none;box-shadow:0 2px 8px #22e19733;letter-spacing:0.01em;}
    #cartOrderBtn:hover {background:linear-gradient(90deg,#1e732b 0%,#20d099 100%);}
    .cart-empty {font-size:16px;color:#abacc3;margin-top:17px;}
    .cartTotal {font-size:19px;font-weight:700;color:#188031;margin:16px 0 0 0;text-align:right;display:none;}
    /* === ФОРМА ЗАКАЗА === */
    #orderForm {
      background: linear-gradient(150deg, #fdfefe, #f4faff);
      border-radius: 22px; max-width: 360px; width: 96%;
      padding: 30px 25px 25px 25px; box-shadow: 0 10px 45px rgba(22, 102, 168, 0.25);
      text-align: center; position: relative; border: 1px solid #e9f5ff;
    }
    #orderForm h3 { margin-top: 0; margin-bottom: 24px; font-size: 1.3em; color: #1a7ab9; font-weight: 800; }
    #orderForm input {
      width: 100%; margin-bottom: 15px; padding: 14px; font-size: 1.05em;
      border-radius: 12px; border: 1.5px solid #d0e6f6;
      box-sizing: border-box; outline: none; transition: border-color 0.2s, box-shadow 0.2s;
    }
    #orderForm input:focus { border-color: #50bafc; box-shadow: 0 0 8px rgba(80, 186, 252, 0.3); }
    #orderPhone {border-color:#7be2ff;}
    #phoneHint {font-size:0.98em;color:#539eca;margin:-9px 0 10px 0;text-align:left;}
    #orderSubmitBtn {
      width: 100%; padding: 14px 20px; font-size: 1.1em; font-weight: 800; color: #fff;
      background: linear-gradient(90deg, #28a745 0%, #21d375 100%);
      border: none; border-radius: 12px; cursor: pointer; margin-top: 10px;
      transition: all 0.2s; box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3); letter-spacing: 0.02em;
    }
    #orderSubmitBtn:hover {
      transform: translateY(-2px); box-shadow: 0 6px 16px rgba(40, 167, 69, 0.4);
      background: linear-gradient(90deg, #218838 0%, #1db96a 100%);
    }
    #orderError {color:#e02437;font-size:0.99em;margin-top:8px;display:none;}
    /* === ОБЩИЕ СТИЛИ === */
    @media (max-width:540px) {
      .modal-content,#orderForm { max-width:98vw;}
      #cartButton { top:8px; right:8px;width:40px;height:40px;}
      #universalBackButton { top:8px; left:8px;width:40px;height:40px;}
    }
    h2, h3 { color: #134b6b; text-align: center;}
    h2#helloTitle {text-align:center;margin:32px 0 0 0;font-size:2rem;font-weight:800;line-height:1.25;letter-spacing:0.01em;color:#134b6b;white-space:pre-line;background:linear-gradient(90deg,var(--gradient-blue-start) 0%,var(--gradient-blue-end) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    #shopLogo {width:165px;height:auto;position:absolute;top:24px;left:24px;margin:0;border-radius:0;background:transparent;box-shadow:none;z-index:10;display:block;transition:opacity 0.3s;}
    body.inner-page #shopLogo { opacity: 0; pointer-events: none;}
    /* === ИСПРАВЛЕНИЕ ВЫРАВНИВАНИЯ СТРАНИЦ === */
    .page-section {
        flex-direction:column; justify-content: flex-start;
        align-items:center; width:100%; display:none;
        padding: 8vh 10px 5vh 10px;
        box-sizing: border-box;
    }
    
    #mainSection {
        justify-content: flex-start;
        padding-top: 120px;
        box-sizing: border-box;
    }
    
    .orderBtn {padding:14px 32px;font-size:18px;font-family:inherit;font-weight:800;color:#fff;background:linear-gradient(90deg,var(--gradient-blue-start) 0%,var(--gradient-blue-end) 100%);border:none;border-radius:8px;box-shadow:0 2px 8px rgba(33,147,176,0.15);cursor:pointer;transition:background 0.3s,transform 0.2s,box-shadow 0.2s;margin-top:28px;display:block;width:280px;margin-left:auto;margin-right:auto;letter-spacing:0.01em;}
    .orderBtn:hover {background:linear-gradient(90deg,#43cea2 0%,#185a9d 100%);transform:translateY(-2px) scale(1.02);box-shadow:0 4px 16px rgba(33,147,176,0.22);}
    .backBtn {display:inline-flex;align-items:center;padding:10px 24px;font-size:17px;font-family:inherit;font-weight:800;background:transparent;color:var(--primary-blue);border:2px solid #b7deff;border-radius:22px;box-shadow:none;cursor:pointer;margin:28px auto 0 auto;transition:all 0.16s;gap:10px;}
    .backBtn:hover {background:var(--light-blue);color:#1a5da2;border-color:#a1c8e6;box-shadow:0 2px 8px #bbe7ff45;}
    .card-block {background:rgba(255,255,255,0.7);padding:16px 14px 16px 14px;border-radius:8px;max-width:380px;margin:0 auto 16px;box-sizing:border-box;clear:both;width:100%;}
    .card-block ul { margin:10px 0 0 0; padding-left: 22px; }
    .card-img {width:170px;height:auto;margin:14px auto 10px;box-shadow:0 4px 12px #b6c2d5c0;border-radius:8px;background:transparent;display:block; transition: transform 0.2s;}
    .card-img.zoomable-img { cursor: zoom-in; }
    .card-img.zoomable-img:hover { transform: scale(1.03); }
    ul {padding-left:22px;text-align:left;font-size:15px;line-height:1.5;}
    
    /* === СТИЛИ ДЛЯ ПОИСКА === */
    .search-wrapper { max-width:380px; width: 100%; margin:0 auto 20px; position:relative; }
    .search-input {
      width:100%; padding:12px 12px 12px 40px; font-size:1em; border-radius:12px;
      border:1.5px solid #d0e6f6; box-sizing:border-box; outline: none;
      background: #fff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23aaa' class='bi bi-search' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'/%3E%3C/svg%3E") 12px center no-repeat;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .search-input:focus { border-color: #50bafc; box-shadow: 0 0 8px rgba(80, 186, 252, 0.3); }
    
    /* === МОДАЛЬНОЕ ОКНО ДЛЯ УВЕЛИЧЕНИЯ ИЗОБРАЖЕНИЙ === */
    #imageModal {
        background: rgba(0,0,0,0.7);
        backdrop-filter: blur(5px);
        cursor: zoom-out;
    }
    #imageModal .modal-content {
        background: transparent;
        box-shadow: none;
        padding: 0;
        width: auto;
        max-width: 95vw;
        max-height: 90vh;
    }
    #imageModal img {
        width: auto;
        height: auto;
        max-width: 100%;
        max-height: 100%;
        border-radius: 12px;
    }
    
    /* === СТИЛИ ДЛЯ АДАПТИВНЫХ ВИДЕО === */
    .card-block iframe {
        max-width: 100%;
        width: 100%;
        aspect-ratio: 16 / 9;
        height: auto;
        border-radius: 8px;
        margin-top: 10px;
        border: none;
    }
    
    /* --- Стили для модального окна "Спасибо за заказ" --- */
    #successModal .modal-content { padding-top: 25px; padding-bottom: 25px; }
    #successIcon { color: var(--success-green); width: 60px; height: 60px; margin-bottom: 15px; }
    #successOkBtn {
        background: var(--success-green); color: white; padding: 12px; font-size: 1.1em;
        font-weight: 800; border-radius: 12px; border: none; cursor: pointer;
        width: 100%; margin-top: 20px; transition: background 0.2s;
    }
    #successOkBtn:hover { background: #218838; }

  </style>
</head>
<body>
  <!-- УНИВЕРСАЛЬНАЯ КНОПКА "НАЗАД" -->
  <button id="universalBackButton" title="Назад">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#3885da">
      <path d="M0 0h24v24H0z" fill="none"/>
      <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
    </svg>
  </button>
  
  <!-- ИКОНКА КОРЗИНЫ -->
  <button id="cartButton" title="Корзина">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
    <span id="cartCount">0</span>
  </button>

  <!-- МОДАЛЬНЫЕ ОКНА -->
  <div id="cartModal" class="modal-overlay">
    <div class="modal-content" id="cartModalContent">
      <button id="cartModalClose" class="modal-close-btn" title="Закрыть">×</button>
      <h2 style="margin-top:0;margin-bottom:16px;font-size:1.4em;color:#207ad2;font-weight:800;letter-spacing:0.01em;">Ваша корзина</h2>
      <ul class="cart-items-list" id="cartItemsList"></ul>
      <div id="cartEmptyMessage" class="cart-empty" style="display:none;">Корзина пуста</div>
      <div class="cartTotal" id="cartTotal" style="display:none;"></div>
      <div class="cart-actions">
        <button class="cartBtn" id="cartContinueBtn">Продолжить покупки</button>
        <button class="cartBtn" id="cartOrderBtn">Оформить заказ</button>
      </div>
    </div>
  </div>
  
  <div id="orderModal" class="modal-overlay">
    <form id="orderForm" class="modal-content">
      <button type="button" id="orderModalClose" class="modal-close-btn" title="Закрыть">×</button>
      <h3>Оформление заказа</h3>
      <input type="tel" id="orderPhone" value="+7" maxlength="12" required>
      <div id="phoneHint">Формат: <b>+7XXXXXXXXXX</b></div>
      <input type="text" id="orderAddress" placeholder="Адрес доставки (необязательно)">
      <button type="submit" id="orderSubmitBtn">Подтвердить заказ</button>
      <div id="orderError" style="display:none;"></div>
    </form>
  </div>
  
  <div id="imageModal" class="modal-overlay">
    <div class="modal-content">
      <img id="modalImage" src="" alt="Увеличенное изображение" />
    </div>
  </div>

  <div id="successModal" class="modal-overlay">
    <div class="modal-content">
        <svg id="successIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
        <h3 style="margin:0; font-size: 1.4em; color: #134b6b;">Спасибо за заказ!</h3>
        <p style="margin:10px 0 0 0; font-size: 1.05em; color: #5a7a92;">Ваши данные отправлены менеджеру. Он скоро с вами свяжется.</p>
        <button id="successOkBtn">Отлично!</button>
    </div>
  </div>
  
  <!-- ЛОГОТИП -->
  <img src="https://web.tk646.ru/wp-content/uploads/2025/06/logotip-sk-2020-scaled.png" alt="Логотип магазина" id="shopLogo" />
  
  <!-- === СТРАНИЦЫ === -->
  <div id="mainSection" class="page-section">
    <h2 id="helloTitle"></h2>
    <button class="orderBtn" id="loggerBtn">Логгер температуры</button>
    <button class="orderBtn" id="recorderBtn">Термописец для товаров с температурным режимом  -5°C…+50°C</button>
    <button class="orderBtn" id="recorderSiBtn">Термописец для товаров с температурным режимом -40°C…+50°C</button>
    <button class="orderBtn" id="recorderSiVerifiedBtn">Термописец для фарм и вет препаратов. Юридически значимый контроль</button>
  </div>
  
  <div id="loggerSection" class="page-section">
    <h2>Логгер температуры <br><span style="font-size:30px; color:var(--primary-blue); font-weight:800; margin-top:8px;">Эскорт TH-BLE</span></h2>
    <img src="https://web.tk646.ru/wp-content/uploads/2025/07/th-ble_podklyuchenie_k_datchiku.gif" alt="Логгер температуры" class="card-img zoomable-img" />
    <p style="max-width:350px;margin:0 auto 18px;text-align:center;font-weight:800;">Умный беспроводной датчик для мониторинга температуры, влажности и магнитного поля.<br>Внесён в реестр СИ РФ, BLE дальностью до 200 метров, 3 года автономной работы.<br>Устойчив к пыли и влаге (IP54), хранит данные даже без связи.</p>
    <button class="orderBtn" id="loggerMoreBtn">Подробнее</button>
    <button class="orderBtn" id="loggerPricesBtn" style="margin-top:12px;">Цены и комплекты</button>
    <button class="backBtn" id="loggerBackBtn"><svg width="24" height="24" fill="none" stroke="var(--primary-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;"><polyline points="15 18 9 12 15 6"/></svg>Назад</button>
  </div>
  
  <div id="loggerDetailSection" class="page-section">
    <h2>Эскорт TH-BLE — подробное описание</h2>
    <img src="https://web.tk646.ru/wp-content/uploads/2025/07/eskort-th-ble_2234.png" class="card-img zoomable-img" alt="Эскорт TH-BLE" />
    <div class="card-block"><ul><li><b>Назначение:</b> мониторинг температуры, влажности, магнитного поля в транспорте, на складах, в медицине и промышленности</li><li><b>Беспроводная связь:</b> Bluetooth Low Energy 4.0/5 Long Range, до 200 м</li><li><b>Автономия:</b> до 3 лет работы от батареи</li><li><b>Память:</b> “черный ящик” — хранение данных при потере связи</li><li><b>Защита:</b> IP54 (пыль, влага, устойчивость к вибрациям)</li><li><b>Документы:</b> внесён в Госреестр СИ РФ; поверка — только аккредитованные лаборатории</li></ul></div>
    <div class="card-block"><b>Технические характеристики:</b><ul><li>Диапазон температуры: -40°С…+50°С, погрешность ±0,5°С</li><li>Влажность: 1–100%, погрешность ±5%</li></ul></div>
    <button class="backBtn" id="loggerDetailBackBtn"><svg width="24" height="24" fill="none" stroke="var(--primary-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;"><polyline points="15 18 9 12 15 6"/></svg>Назад</button>
  </div>
  
  <div id="loggerPricesSection" class="page-section">
    <h2>Цены и комплекты</h2>
    <div class="search-wrapper"><input type="text" id="loggerSearchInput" class="search-input" placeholder="Найти, например, 'с поверкой'..."></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/07/eskort-th-ble_2231.png" alt="TH-BLE датчик" style="width:105px;height:auto;float:right;margin:0 0 8px 16px;background:transparent;" class="zoomable-img"><b>Логгер Эскорт TH-BLE</b><br>Датчик без поверки.<div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>7 500 ₽</b></div><button class="orderBtn productCartBtn" data-id="thble" data-name="Логгер Эскорт TH-BLE" data-price="7500">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/06/metrologiya-3.jpg" alt="Поверка" style="width:95px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Метрологическая поверка</b><br>Свидетельство о поверке.<div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>2 500 ₽</b></div><button class="orderBtn productCartBtn" data-id="verify" data-name="Поверка TH-BLE" data-price="2500">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/07/eskortrst.jpg" alt="С поверкой" style="width:95px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Логгер с поверкой</b><br>Датчик с поверкой (в Реестре СИ).<div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>10 000 ₽</b></div><button class="orderBtn productCartBtn" data-id="thble-verif" data-name="Логгер TH-BLE с поверкой" data-price="10000">В корзину</button><div style="clear:both;"></div></div>
    <button class="backBtn" id="loggerPricesBackBtn"><svg width="24" height="24" fill="none" stroke="var(--primary-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;"><polyline points="15 18 9 12 15 6"/></svg>Назад</button>
  </div>
  
  <div id="recorderSection" class="page-section">
    <h2>Термописец (Термочек)<br><span style="font-size:30px; color:var(--primary-blue); font-weight:800; margin-top:8px;">ARNAVI BTS v.5</span></h2>
    <img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2295-kopiya.png" alt="Термописец ARNAVI" class="card-img zoomable-img" />
    <p style="max-width:350px;margin:0 auto 18px;text-align:center;font-weight:800;">Контроль температуры и мгновенная печать отчёта ("термочека").<br>Без проводов, без поверки.</p>
    <button class="orderBtn" id="recorderMoreBtn">Подробнее</button>
    <button class="orderBtn" id="recorderPricesBtn" style="margin-top:12px;">Цены и комплекты</button>
    <button class="backBtn" id="recorderBackBtn"><svg width="24" height="24" fill="none" stroke="var(--primary-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;"><polyline points="15 18 9 12 15 6"/></svg>Назад</button>
  </div>
  
  <div id="recorderDetailSection" class="page-section">
    <h2>Термописец ARNAVI — подробное описание</h2>
    <div style="display:flex; justify-content:center; align-items:center; gap: 15px; flex-wrap:wrap; margin-bottom: 20px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2295-kopiya.png" class="card-img zoomable-img" style="width:170px; margin:0;" alt="Комплект термописца" /><img src="https://web.tk646.ru/wp-content/uploads/2025/07/chek.png" class="card-img zoomable-img" style="width:120px; margin:0;" alt="Пример термочека" /></div>
    <div class="card-block"><b>Ключевые преимущества:</b><ul><li><b>Мгновенный термочек:</b> печать отчёта на месте выгрузки.</li><li><b>Без бюрократии:</b> датчики не требуют поверки и внесения в Госреестр СИ.</li><li><b>Простая установка:</b> модуль в прикуриватель, датчики на магнитах.</li></ul></div>
    <div class="card-block"><b>Технические характеристики ARNAVI BTS v.5</b><ul><li>Габариты: 61 x 42 x 13 мм, масса — 30 г</li><li>Диапазон температур: -5°C…+50°C</li><li>Время работы:</li><li>Морозилка -5 °C... -0°C-400 дней</li><li>Холодильник 0 °C... +5°C-700 дней</li><li>Комната +5 °C... +25°C-1 500 дней</li></ul></div>
    <div class="card-block" style="text-align:center;"><b>Посмотрите видео о работе системы:</b>
      <iframe src="https://rutube.ru/video/embed/570283471933912da8a93194ac8d30c0/" frameBorder="0" allow="clipboard-write; autoplay" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
    </div>
    <button class="backBtn" id="recorderDetailBackBtn"><svg width="24" height="24" fill="none" stroke="var(--primary-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;"><polyline points="15 18 9 12 15 6"/></svg>Назад</button>
  </div>
  
  <div id="recorderPricesSection" class="page-section">
    <h2>Цены и комплекты</h2>
    <div class="search-wrapper"><input type="text" id="recorderSearchInput" class="search-input" placeholder="Найти, например, 'принтер'..."></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2261-kopiya.png" alt="Комплект 1" style="width:105px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Модуль + 1 датчик</b><br>Базовый комплект.<div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>от 11 500 ₽</b></div><button class="orderBtn productCartBtn" data-id="rec1" data-name="Термописец (Модуль + 1 датчик)" data-price="11500">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2287-kopiya.png" alt="Комплект 2" style="width:105px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Модуль + 2 датчика</b><br>Для контроля двух зон.<div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>от 16 000 ₽</b></div><button class="orderBtn productCartBtn" data-id="rec2" data-name="Термописец (Модуль + 2 датчика)" data-price="16000">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2276-kopiya.png" alt="Комплект 3" style="width:105px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Модуль + 1 датчик + принтер</b><br>С печатью чеков.<div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>от 16 500 ₽</b></div><button class="orderBtn productCartBtn" data-id="rec3" data-name="Термописец (Модуль + 1 датчик + принтер)" data-price="16500">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2295-kopiya.png" alt="Комплект 4" style="width:105px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Модуль + 2 датчика + принтер</b><br>Максимальный комплект.<div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>от 21 000 ₽</b></div><button class="orderBtn productCartBtn" data-id="rec4" data-name="Термописец (Модуль + 2 датчика + принтер)" data-price="21000">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block" style="text-align:center;"><b>Абонентское обслуживание: 600 ₽/мес</b><br>Включает SIM, сервер и поддержку.</div>
    <button class="backBtn" id="recorderPricesBackBtn"><svg width="24" height="24" fill="none" stroke="var(--primary-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;"><polyline points="15 18 9 12 15 6"/></svg>Назад</button>
  </div>
  
  <div id="recorderSiSection" class="page-section">
    <h2>Термописец в Реестре СИ<br><span style="font-size:24px; color:#1a7ab9; font-weight:800; margin-top:8px;">Юридически значимый контроль</span></h2>
    <img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2327-kopiya.png" alt="Термописец в Реестре СИ" class="card-img zoomable-img" />
    <p style="max-width:350px;margin:0 auto 18px;text-align:center;font-weight:800;">Контроль температуры и мгновенная печать отчёта ("термочека"). Датчики <b>внесены в Госреестр СИ РФ</b> Номер в ГРСИ РФ: <b>87325-22</b>.</p>
    <button class="orderBtn" id="recorderSiMoreBtn">Подробнее</button>
    <button class="orderBtn" id="recorderSiPricesBtn" style="margin-top:12px;">Цены и комплекты</button>
    <button class="backBtn" id="recorderSiBackBtn"><svg width="24" height="24" fill="none" stroke="var(--primary-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;"><polyline points="15 18 9 12 15 6"/></svg>Назад</button>
  </div>
  
  <div id="recorderSiDetailSection" class="page-section">
    <h2>Термописец (Термочек) — ЭСКОРТ TH-BLE</h2>
    <div style="display:flex; justify-content:center; align-items:center; gap: 15px; flex-wrap:wrap; margin-bottom: 20px;">
      <img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2327-kopiya.png" class="card-img zoomable-img" style="width:170px; margin:0;" alt="Комплект термописца СИ" />
      <img src="https://web.tk646.ru/wp-content/uploads/2025/07/chek.png" class="card-img zoomable-img" style="width:120px; margin:0;" alt="Пример термочека" />
    </div>
    <div class="card-block"><b>Датчик ЭСКОРТ TH-BLE</b><ul><li>Диапазон температуры: -40…+50°C</li><li>Погрешность: ±0,5°C (-30…+50°C), ±1,0°C (-40…-30°C)</li><li>Влажность: 1–100%, погрешность ±5%</li><li>Время работы от батареи: не менее 2 лет</li><li>Стандарт Bluetooth: BLE 4.0/5 LR, дальность до 200 м</li><li>Степень защиты: IP54</li><li>Размеры: 105×95×40 мм</li><li>Масса: ≤0,4 кг</li><li>Внесён в Госреестр СИ РФ, при необходимости может быть метрологически поверен (цены в разделе "Термописец для фарм и вет препаратов")</li></ul></div>
        <div class="card-block" style="text-align:center;"><b>Посмотрите видео о решении:</b>
      <iframe src="https://rutube.ru/video/embed/d809805bc4af577428d483c99104e97d/" frameBorder="0" allow="clipboard-write; autoplay" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
    </div>
    <button class="backBtn" id="recorderSiDetailBackBtn"><svg width="24" height="24" fill="none" stroke="var(--primary-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;"><polyline points="15 18 9 12 15 6"/></svg>Назад</button>
  </div>
  
  <div id="recorderSiPricesSection" class="page-section">
    <h2>Цены и комплекты (Реестр СИ)</h2>
    <div class="search-wrapper"><input type="text" id="recorderSiSearchInput" class="search-input" placeholder="Найти, например, 'с поверкой'..."></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2310-kopiya.png" alt="Комплект 1 СИ" style="width:105px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Модуль + 1 датчик</b><div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>от 14 500 ₽</b></div><button class="orderBtn productCartBtn" data-id="recSi1" data-name="Термописец СИ (Модуль + 1 датчик с поверкой)" data-price="14500">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2323-kopiya.png" alt="Комплект 2 СИ" style="width:105px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Модуль + 2 датчика</b><div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>от 22 000 ₽</b></div><button class="orderBtn productCartBtn" data-id="recSi2" data-name="Термописец СИ (Модуль + 2 датчика с поверкой)" data-price="22000">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/08/sfg_2314-kopiya-e1754298100956.png" alt="Комплект 3 СИ" style="width:105px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Модуль + 1 датчик + принтер</b><div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>от 19 500 ₽</b></div><button class="orderBtn productCartBtn" data-id="recSi3" data-name="Термописец СИ (Модуль + 1 датчик + принтер)" data-price="19500">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2327-kopiya.png" alt="Комплект 4 СИ" style="width:105px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Модуль + 2 датчика + принтер</b><div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>от 27 000 ₽</b></div><button class="orderBtn productCartBtn" data-id="recSi4" data-name="Термописец СИ (Модуль + 2 датчика + принтер)" data-price="27000">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block" style="text-align:center;"><b>Абонентское обслуживание: 600 ₽/мес</b><br>Включает SIM, сервер и поддержку.</div>
    <button class="backBtn" id="recorderSiPricesBackBtn"><svg width="24" height="24" fill="none" stroke="var(--primary-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;"><polyline points="15 18 9 12 15 6"/></svg>Назад</button>
  </div>
  
  <!-- РАЗДЕЛ "ТЕРМОПИСЕЦ ДЛЯ ФАРМ И ВЕТ ПРЕПАРАТОВ" -->
  <div id="recorderSiVerifiedSection" class="page-section">
    <h2>Термописец в Реестре СИ поверенный<br><span style="font-size:24px; color:#1a7ab9; font-weight:800; margin-top:8px;">Юридически значимый контроль (поверенный)</span></h2>
    <img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2327-kopiya.png" alt="Термописец в Реестре СИ поверенный" class="card-img zoomable-img" />
    <p style="max-width:350px;margin:0 auto 18px;text-align:center;font-weight:800;">Официальное решение для фармацевтики. Датчики <b>внесены в Госреестр СИ РФ</b> и проходят <b>метрологическую поверку. Номер в ГРСИ РФ: 87325-22</b>.</p>
    <button class="orderBtn" id="recorderSiVerifiedMoreBtn">Подробнее</button>
    <button class="orderBtn" id="recorderSiVerifiedPricesBtn" style="margin-top:12px;">Цены и комплекты</button>
    <button class="backBtn" id="recorderSiVerifiedBackBtn"><svg width="24" height="24" fill="none" stroke="var(--primary-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;"><polyline points="15 18 9 12 15 6"/></svg>Назад</button>
  </div>
  
  <div id="recorderSiVerifiedDetailSection" class="page-section">
    <h2>Термописец в Реестре СИ (поверенный) — Подробности</h2>
    <div style="display:flex; justify-content:center; align-items:center; gap: 15px; flex-wrap:wrap; margin-bottom: 20px;">
      <img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2327-kopiya.png" class="card-img zoomable-img" style="width:170px; margin:0;" alt="Комплект термописца СИ" />
      <img src="https://web.tk646.ru/wp-content/uploads/2025/07/chek.png" class="card-img zoomable-img" style="width:120px; margin:0;" alt="Пример термочека" />
    </div>
    <div class="card-block"><b>Датчик ЭСКОРТ TH-BLE</b><ul><li>Диапазон температуры: -40…+50°C</li><li>Погрешность: ±0,5°C (-30…+50°C), ±1,0°C (-40…-30°C)</li><li>Влажность: 1–100%, погрешность ±5%</li><li>Время работы от батареи: не менее 2 лет</li><li>Стандарт Bluetooth: BLE 4.0/5 LR, дальность до 200 м</li><li>Степень защиты: IP54</li><li>Размеры: 105×95×40 мм</li><li>Масса: ≤0,4 кг</li><li>Внесён в Госреестр СИ РФ, проходит метрологическую поверку</li></ul></div>
    <div class="card-block"><b>Модуль мониторинга</b><ul><li>Передача данных на сервер по GPRS</li><li>Встроенная энергонезависимая память</li><li>Работа при перебоях связи — автоматическая выгрузка после восстановления</li><li>Простое подключение: 12/24В через прикуриватель</li><li>Мобильная установка без вмешательства в электрику</li></ul></div>
    <div class="card-block"><b>Программное обеспечение и поверка</b><ul><li>Внесено в Реестр российского ПО</li><li>Формирование и печать температурных отчётов (термочек)</li><li>Веб-интерфейс и мобильное приложение (Android/iOS/ПК)</li><li>Онлайн-мониторинг, аналитика, уведомления</li><li>Интеграция с внешними учетными системами (1С, WMS и др.)</li><li>Гибкое управление пользователями и объектами</li><li>Метрологическая поверка проводится аккредитованными лабораториями</li><li>Гарантия юридической значимости данных</li></ul></div>
    <div class="card-block" style="text-align:center;"><b>Посмотрите видео о решении:</b>
      <iframe src="https://rutube.ru/video/embed/d809805bc4af577428d483c99104e97d/" frameBorder="0" allow="clipboard-write; autoplay" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
    </div>
    <button class="backBtn" id="recorderSiVerifiedDetailBackBtn"><svg width="24" height="24" fill="none" stroke="var(--primary-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;"><polyline points="15 18 9 12 15 6"/></svg>Назад</button>
  </div>

  <div id="recorderSiVerifiedPricesSection" class="page-section">
    <h2>Цены и комплекты (Реестр СИ поверенный)</h2>
    <div class="search-wrapper"><input type="text" id="recorderSiVerifiedSearchInput" class="search-input" placeholder="Найти, например, 'с поверкой'..."></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2310-kopiya.png" alt="Комплект 1 СИ" style="width:105px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Модуль + 1 датчик с поверкой</b><div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>от 17 000 ₽</b></div><button class="orderBtn productCartBtn" data-id="recSiVer1" data-name="Термописец СИ поверенный (1 датчик)" data-price="17000">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2323-kopiya.png" alt="Комплект 2 СИ" style="width:105px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Модуль + 2 датчика с поверкой</b><div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>от 27 000 ₽</b></div><button class="orderBtn productCartBtn" data-id="recSiVer2" data-name="Термописец СИ поверенный (2 датчика)" data-price="27000">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/08/sfg_2314-kopiya-e1754298100956.png" alt="Комплект 3 СИ" style="width:105px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Модуль + 1 датчик с поверкой + принтер</b><div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>от 22 000 ₽</b></div><button class="orderBtn productCartBtn" data-id="recSiVer3" data-name="Термописец СИ поверенный (1 датчик + принтер)" data-price="22000">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block product-card" style="margin-bottom:22px;"><img src="https://web.tk646.ru/wp-content/uploads/2025/07/sfg_2327-kopiya.png" alt="Комплект 4 СИ" style="width:105px;height:auto;float:right;margin:0 0 8px 16px;" class="zoomable-img"><b>Модуль + 2 датчика с поверкой + принтер</b><div style="font-size:18px;color:#248d00;margin:10px 0 6px 0;font-weight:800;"><b>от 32 000 ₽</b></div><button class="orderBtn productCartBtn" data-id="recSiVer4" data-name="Термописец СИ поверенный (2 датчика + принтер)" data-price="32000">В корзину</button><div style="clear:both;"></div></div>
    <div class="card-block" style="text-align:center;"><b>Абонентское обслуживание: 600 ₽/мес</b><br>Включает SIM, сервер и поддержку.</div>
    <button class="backBtn" id="recorderSiVerifiedPricesBackBtn"><svg width="24" height="24" fill="none" stroke="var(--primary-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;"><polyline points="15 18 9 12 15 6"/></svg>Назад</button>
  </div>

  
  <!-- JAVASCRIPT -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    try {
      let tgUser = {};
      let cart = [];
      let pageHistory = ['main']; // Стек для истории навигации

      const setPage = (page, isBack = false) => {
        document.body.className = (page === 'main') ? '' : 'inner-page';
        document.querySelectorAll('.page-section').forEach(s => s.style.display = 'none');
        const activeSection = document.getElementById(page + 'Section');
        if (activeSection) activeSection.style.display = 'flex';
        
        // Управление видимостью кнопки "Назад"
        const backBtn = document.getElementById('universalBackButton');
        if (page === 'main') {
            backBtn.style.display = 'none';
        } else {
            backBtn.style.display = 'flex';
        }

        // Обновление истории навигации
        if (!isBack) {
            pageHistory.push(page);
        }
      };

      const goBack = () => {
          if (pageHistory.length > 1) {
              pageHistory.pop(); // Удаляем текущую страницу
              const prevPage = pageHistory[pageHistory.length - 1]; // Получаем предыдущую
              setPage(prevPage, true); // Переходим без добавления в историю
          }
      };

      const updateCartCount = () => {
        const cartCountElem = document.getElementById('cartCount');
        if (!cartCountElem) return;
        const n = cart.reduce((sum, item) => sum + item.qty, 0);
        cartCountElem.textContent = n;
        cartCountElem.style.display = n > 0 ? 'block' : 'none';
      };

      const renderCartModal = () => {
        const list = document.getElementById('cartItemsList');
        const totalDiv = document.getElementById('cartTotal');
        const orderBtn = document.getElementById('cartOrderBtn');
        const emptyMsg = document.getElementById('cartEmptyMessage');
        if (!list || !totalDiv || !orderBtn || !emptyMsg) return;
        list.innerHTML = '';
        if (cart.length === 0) {
          emptyMsg.style.display = 'block';
          list.style.display = 'none';
          totalDiv.style.display = 'none';
          orderBtn.style.display = 'none';
          return;
        }
        emptyMsg.style.display = 'none';
        orderBtn.style.display = 'flex';
        list.style.display = 'block';
        cart.forEach(item => {
          const li = document.createElement('li');
          li.className = 'cart-item';
          li.innerHTML = `<span>${item.name}${item.qty > 1 ? ' ×' + item.qty : ''}</span>
                          <span>${(item.price * item.qty).toLocaleString('ru-RU')} ₽ 
                            <button class="remove-item-btn" data-id="${item.id}" style="background:none;border:none;color:#c22138;font-size:20px;font-weight:700;cursor:pointer;padding:0 0 0 8px;vertical-align:middle;" title="Удалить">×</button>
                          </span>`;
          list.appendChild(li);
        });
        const total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);
        totalDiv.textContent = 'Итого: ' + total.toLocaleString('ru-RU') + ' ₽';
        totalDiv.style.display = 'block';
      };
      
      const addToCart = (id, name, price) => {
        const item = cart.find(x => x.id === id);
        if (item) {
          item.qty++;
        } else {
          cart.push({ id, name, price: parseInt(price, 10), qty: 1 });
        }
        updateCartCount();
      };
      
      const removeCartItem = (id) => {
          cart = cart.filter(item => item.id !== id);
          updateCartCount();
          renderCartModal();
      };

      const openModal = (id) => {
          const modal = document.getElementById(id);
          if (modal) modal.classList.add('active');
          if (id === 'cartModal') renderCartModal();
      };
      const closeModal = (id) => {
          const modal = document.getElementById(id);
          if (modal) modal.classList.remove('active');
      };
      
      const filterProducts = (inputId, containerId) => {
          const filter = document.getElementById(inputId).value.toLowerCase();
          const cards = document.getElementById(containerId).getElementsByClassName('product-card');
          Array.from(cards).forEach(card => {
              const textContent = card.textContent || card.innerText;
              card.style.display = textContent.toLowerCase().includes(filter) ? "" : "none";
          });
      };

      document.addEventListener('DOMContentLoaded', () => {
        if (window.Telegram && window.Telegram.WebApp) {
          window.Telegram.WebApp.ready();
          tgUser = window.Telegram.WebApp.initDataUnsafe?.user || {};
          const firstName = tgUser.first_name || "Гость";
          const helloTitle = document.getElementById('helloTitle');
          if(helloTitle) helloTitle.innerHTML = `Привет, ${firstName}!<br> Добро пожаловать!<br> 🛒`;
        }

        const navMap = { 
            'loggerBtn': 'logger', 'loggerMoreBtn': 'loggerDetail', 'loggerPricesBtn': 'loggerPrices', 
            'loggerBackBtn': 'main', 'loggerDetailBackBtn': 'logger', 'loggerPricesBackBtn': 'logger', 
            'recorderBtn': 'recorder', 'recorderMoreBtn': 'recorderDetail', 'recorderPricesBtn': 'recorderPrices', 
            'recorderBackBtn': 'main', 'recorderDetailBackBtn': 'recorder', 'recorderPricesBackBtn': 'recorder', 
            'recorderSiBtn': 'recorderSi', 'recorderSiMoreBtn': 'recorderSiDetail', 'recorderSiPricesBtn': 'recorderSiPrices', 
            'recorderSiBackBtn': 'main', 'recorderSiDetailBackBtn': 'recorderSi', 'recorderSiPricesBackBtn': 'recorderSi',
            'recorderSiVerifiedBtn': 'recorderSiVerified', 'recorderSiVerifiedMoreBtn': 'recorderSiVerifiedDetail', 'recorderSiVerifiedPricesBtn': 'recorderSiVerifiedPrices',
            'recorderSiVerifiedBackBtn': 'main', 'recorderSiVerifiedDetailBackBtn': 'recorderSiVerified', 'recorderSiVerifiedPricesBackBtn': 'recorderSiVerified'
        };
        for (const [btnId, pageName] of Object.entries(navMap)) {
          const btn = document.getElementById(btnId);
          if (btn) btn.onclick = () => setPage(pageName);
        }

        document.getElementById('cartButton').onclick = () => openModal('cartModal');
        document.getElementById('cartModalClose').onclick = () => closeModal('cartModal');
        document.getElementById('cartContinueBtn').onclick = () => closeModal('cartModal');
        document.getElementById('cartOrderBtn').onclick = () => {
            closeModal('cartModal');
            openModal('orderModal');
        };
        document.getElementById('orderModalClose').onclick = () => closeModal('orderModal');
        document.getElementById('successOkBtn').onclick = () => closeModal('successModal');

        document.getElementById('universalBackButton').onclick = goBack;

        document.querySelectorAll('.productCartBtn').forEach(btn => {
          btn.onclick = () => {
            addToCart(btn.dataset.id, btn.dataset.name, btn.dataset.price);
            openModal('cartModal');
          };
        });
        
        document.getElementById('cartItemsList').addEventListener('click', (e) => {
            if (e.target && e.target.classList.contains('remove-item-btn')) {
                removeCartItem(e.target.dataset.id);
            }
        });

        document.getElementById('orderForm').onsubmit = async (e) => {
          e.preventDefault();
          const phone = document.getElementById('orderPhone').value.trim();
          const address = document.getElementById('orderAddress').value.trim();
          const errorDiv = document.getElementById('orderError');
          const submitBtn = document.getElementById('orderSubmitBtn');
          if (!/^\+7\d{10}$/.test(phone)) {
            errorDiv.textContent = 'Введите номер в формате +7XXXXXXXXXX';
            errorDiv.style.display = 'block';
            return;
          }
          errorDiv.style.display = 'none';
          submitBtn.disabled = true;
          submitBtn.textContent = 'Отправка...';
          try {
            const backendUrl = '/api/send-order';
            const response = await fetch(backendUrl, {
              method: "POST",
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ phone, address, cart, user: tgUser })
            });
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Ошибка ответа сервера.');
            }
            
            closeModal('orderModal');
            openModal('successModal');
            
            cart = [];
            updateCartCount();
            
          } catch (err) {
            errorDiv.textContent = 'Ошибка: ' + err.message;
            errorDiv.style.display = 'block';
            console.error(err);
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Подтвердить заказ';
          }
        };

        const searchInputs = { 
            'loggerSearchInput': 'loggerPricesSection', 
            'recorderSearchInput': 'recorderPricesSection', 
            'recorderSiSearchInput': 'recorderSiPricesSection',
            'recorderSiVerifiedSearchInput': 'recorderSiVerifiedPricesSection'
        };
        for (const [inputId, sectionId] of Object.entries(searchInputs)) {
          const inputElement = document.getElementById(inputId);
          if (inputElement) inputElement.addEventListener('keyup', () => filterProducts(inputId, sectionId));
        }

        const imageModal = document.getElementById('imageModal');
        const modalImage = document.getElementById('modalImage');
        document.querySelectorAll('.zoomable-img').forEach(img => {
          img.addEventListener('click', (e) => {
            e.stopPropagation();
            modalImage.src = img.src;
            openModal('imageModal');
          });
        });
        imageModal.addEventListener('click', () => closeModal('imageModal'));
        
        updateCartCount();
        setPage('main');
      });
    } catch (e) {
        alert('Критическая ошибка в JavaScript: ' + e.message);
    }
  </script>
</body>
</html>
